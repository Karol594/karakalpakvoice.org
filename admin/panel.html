<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - KarakalpakVoice.org</title>
    <meta name="robots" content="noindex, nofollow">
    <style>
        :root {
            --primary-blue: #00d4ff;
            --secondary-blue: #0099cc;
            --primary-yellow: #ffd700;
            --dark-bg: #1a1a1a;
            --dark-secondary: #2d2d2d;
            --white: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--dark-secondary) 100%);
            color: var(--white);
            min-height: 100vh;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
        }

        .login-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            width: 90%;
            max-width: 400px;
        }

        .login-logo {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--primary-blue), var(--primary-yellow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-title {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            color: var(--white);
        }

        .login-form {
            text-align: left;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--white);
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: var(--white);
            font-size: 1rem;
            backdrop-filter: blur(10px);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .login-btn {
            width: 100%;
            padding: 1rem;
            background: var(--primary-blue);
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: var(--secondary-blue);
            transform: translateY(-2px);
        }

        .error-message {
            background: #dc3545;
            color: white;
            padding: 0.8rem;
            border-radius: 8px;
            margin-top: 1rem;
            display: none;
            text-align: center;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--dark-secondary) 100%);
        }

        .admin-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--primary-blue), var(--primary-yellow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .admin-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            background: linear-gradient(45deg, var(--primary-blue), var(--primary-yellow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Language Tabs */
        .language-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .lang-tab {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: var(--white);
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }

        .lang-tab.active {
            background: var(--primary-blue);
            border-color: var(--primary-blue);
            color: white;
        }

        .lang-tab:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--primary-blue);
        }

        /* Article Form */
        .article-form {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 2rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: var(--white);
            font-size: 1rem;
            backdrop-filter: blur(10px);
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 200px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .file-upload:hover {
            border-color: var(--primary-blue);
            background: rgba(0, 212, 255, 0.1);
        }

        .file-upload input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .file-upload-text {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .file-upload-hint {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
        }

        /* File Preview */
        .file-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .preview-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            position: relative;
        }

        .preview-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .preview-item video {
            width: 100%;
            height: 120px;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .action-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .publish-btn {
            background: #28a745;
            color: white;
        }

        .publish-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .draft-btn {
            background: var(--primary-yellow);
            color: #333;
        }

        .draft-btn:hover {
            background: #e6c200;
            transform: translateY(-2px);
        }

        .preview-btn {
            background: var(--primary-blue);
            color: white;
        }

        .preview-btn:hover {
            background: var(--secondary-blue);
            transform: translateY(-2px);
        }

        /* Success Message */
        .success-message {
            background: #28a745;
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            text-align: center;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Recent Articles */
        .recent-articles {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 2rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .recent-articles h3 {
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.5rem;
        }

        .article-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .article-info h4 {
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
        }

        .article-meta {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .article-actions {
            display: flex;
            gap: 0.5rem;
        }

        .article-actions button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .edit-btn {
            background: var(--primary-blue);
            color: white;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .language-tabs {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .lang-tab {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .article-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .article-actions {
                width: 100%;
                justify-content: center;
            }
        }

        /* Particles Animation */
        .admin-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--primary-blue);
            border-radius: 50%;
            animation: float 8s infinite linear;
            opacity: 0.3;
        }

        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 0; }
            50% { opacity: 0.3; }
            100% { transform: translate(100px, -100px) rotate(360deg); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Particles Background -->
    <div class="admin-particles" id="adminParticles"></div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-logo">🔐</div>
            <h1 class="login-title">Admin Panel</h1>
            <h2 style="font-size: 1rem; margin-bottom: 2rem; color: rgba(255,255,255,0.8);">KarakalpakVoice.org</h2>
            
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="username">Логин:</label>
                    <input type="text" id="username" required autocomplete="username">
                </div>
                
                <div class="form-group">
                    <label for="password">Пароль:</label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                
                <button type="submit" class="login-btn">ВОЙТИ</button>
                
                <div id="loginError" class="error-message">
                    Неверный логин или пароль!
                </div>
            </form>
            
            <div style="margin-top: 2rem; font-size: 0.8rem; color: rgba(255,255,255,0.5); text-align: center;">
                Только для авторизованного персонала
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-logo">Қарақалпақ Даўысы - Admin</div>
            <button id="logoutBtn" class="logout-btn">Выход</button>
        </header>

        <div class="admin-container">
            <h1 class="admin-title">Админ панели</h1>

            <!-- Success Message -->
            <div id="successMessage" class="success-message">
                Мақала сәтли жарияланды! ✅
            </div>

            <!-- Language Tabs -->
            <div class="language-tabs">
                <button class="lang-tab active" data-lang="ru">🇷🇺 Русский</button>
                <button class="lang-tab" data-lang="kaa">🏳️ Қарақалпақша</button>
                <button class="lang-tab" data-lang="en">🇺🇸 English</button>
                <button class="lang-tab" data-lang="pl">🇵🇱 Polski</button>
            </div>

            <!-- Article Form -->
            <div class="article-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Заголовок статьи:</label>
                        <input type="text" id="articleTitle" placeholder="Введите заголовок..." required>
                    </div>
                    <div class="form-group">
                        <label>Категория:</label>
                        <select id="articleCategory" required>
                            <option value="">Выберите категорию</option>
                            <option value="news">Жаңалықлар</option>
                            <option value="sovereignty">Суверенитет</option>
                            <option value="politics">Сиясат</option>
                            <option value="history">Тарийх</option>
                            <option value="sport">Спорт</option>
                            <option value="geography">География</option>
                            <option value="traditions">Дәстүр</option>
                            <option value="religion">Дин</option>
                        </select>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label>Содержание статьи:</label>
                    <textarea id="articleContent" placeholder="Скопируйте текст статьи из блокнота..." required></textarea>
                </div>

                <div class="form-group full-width">
                    <label>Медиа файлы (изображения, видео, аудио):</label>
                    <div class="file-upload" id="fileUpload">
                        <input type="file" id="mediaFiles" multiple accept="image/*,video/*,audio/*">
                        <div class="file-upload-icon">📁</div>
                        <div class="file-upload-text">Перетащите файлы сюда</div>
                        <div class="file-upload-hint">или нажмите для выбора</div>
                    </div>
                    <div id="filePreview" class="file-preview"></div>
                </div>

                <div class="action-buttons">
                    <button type="button" id="publishBtn" class="action-btn publish-btn">
                        🚀 ЖӘРИЯЛАЎ
                    </button>
                    <button type="button" id="draftBtn" class="action-btn draft-btn">
                        💾 САҚЛАЎ
                    </button>
                    <button type="button" id="previewBtn" class="action-btn preview-btn">
                        👁️ КӨРИЎ
                    </button>
                </div>
            </div>

            <!-- Recent Articles -->
            <div class="recent-articles">
                <h3>Соңғы мақалалар</h3>
                <div id="recentArticles">
                    <!-- Articles will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple Admin System
        const ADMIN = {
            // Change these credentials!
            username: 'karakalpak',
            password: 'voice2025',
            
            // Current state
            isLoggedIn: false,
            currentLanguage: 'ru',
            uploadedFiles: []
        };

        // Language content
        const LANGUAGE_CONTENT = {
            ru: { title: '', content: '' },
            kaa: { title: '', content: '' },
            en: { title: '', content: '' },
            pl: { title: '', content: '' }
        };

        // Create particles
        function createAdminParticles() {
            const container = document.getElementById('adminParticles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.top = Math.random() * 100 + 'vh';
                particle.style.animationDelay = Math.random() * 8 + 's';
                container.appendChild(particle);
            }
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === ADMIN.username && password === ADMIN.password) {
                ADMIN.isLoggedIn = true;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadRecentArticles();
                createAdminParticles();
            } else {
                document.getElementById('loginError').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('loginError').style.display = 'none';
                }, 3000);
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', () => {
            ADMIN.isLoggedIn = false;
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            clearForm();
        });

        // Language tabs
        document.querySelectorAll('.lang-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Save current language content
                LANGUAGE_CONTENT[ADMIN.currentLanguage] = {
                    title: document.getElementById('articleTitle').value,
                    content: document.getElementById('articleContent').value
                };
                
                // Switch active tab
                document.querySelectorAll('.lang-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Update current language
                ADMIN.currentLanguage = tab.dataset.lang;
                
                // Load content for new language
                document.getElementById('articleTitle').value = LANGUAGE_CONTENT[ADMIN.currentLanguage].title || '';
                document.getElementById('articleContent').value = LANGUAGE_CONTENT[ADMIN.currentLanguage].content || '';
                
                // Update placeholders based on language
                updatePlaceholders(ADMIN.currentLanguage);
            });
        });

        // Update placeholders
        function updatePlaceholders(lang) {
            const placeholders = {
                ru: {
                    title: 'Введите заголовок статьи...',
                    content: 'Скопируйте текст статьи из блокнота...'
                },
                kaa: {
                    title: 'Мақала атын жазыңыз...',
                    content: 'Блокноттан мақала текстин көшириңиз...'
                },
                en: {
                    title: 'Enter article title...',
                    content: 'Copy article text from notepad...'
                },
                pl: {
                    title: 'Wprowadź tytuł artykułu...',
                    content: 'Skopiuj tekst artykułu z notatnika...'
                }
            };
            
            if (placeholders[lang]) {
                document.getElementById('articleTitle').placeholder = placeholders[lang].title;
                document.getElementById('articleContent').placeholder = placeholders[lang].content;
            }
        }

        // File upload functionality
        const fileUpload = document.getElementById('fileUpload');
        const mediaFiles = document.getElementById('mediaFiles');
        const filePreview = document.getElementById('filePreview');

        // Drag and drop
        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.style.borderColor = 'var(--primary-blue)';
            fileUpload.style.background = 'rgba(0, 212, 255, 0.1)';
        });

        fileUpload.addEventListener('dragleave', (e) => {
            e.preventDefault();
            fileUpload.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            fileUpload.style.background = 'transparent';
        });

        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            fileUpload.style.background = 'transparent';
            
            const files = Array.from(e.dataTransfer.files);
            handleFiles(files);
        });

        mediaFiles.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleFiles(files);
        });

        function handleFiles(files) {
            files.forEach(file => {
                if (file.type.startsWith('image/') || file.type.startsWith('video/') || file.type.startsWith('audio/')) {
                    ADMIN.uploadedFiles.push(file);
                    createFilePreview(file);
                }
            });
        }

        function createFilePreview(file) {
            const previewItem = document.createElement('div');
            previewItem.className = 'preview-item';
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-file';
            removeBtn.innerHTML = '×';
            removeBtn.onclick = () => {
                ADMIN.uploadedFiles = ADMIN.uploadedFiles.filter(f => f !== file);
                previewItem.remove();
            };
            
            if (file.type.startsWith('image/')) {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                previewItem.appendChild(img);
            } else if (file.type.startsWith('video/')) {
                const video = document.createElement('video');
                video.src = URL.createObjectURL(file);
                video.controls = true;
                previewItem.appendChild(video);
            } else if (file.type.startsWith('audio/')) {
                const audio = document.createElement('audio');
                audio.src = URL.createObjectURL(file);
                audio.controls = true;
                previewItem.appendChild(audio);
            }
            
            const fileName = document.createElement('div');
            fileName.textContent = file.name;
            fileName.style.fontSize = '0.8rem';
            fileName.style.marginTop = '0.5rem';
            fileName.style.wordBreak = 'break-all';
            
            previewItem.appendChild(removeBtn);
            previewItem.appendChild(fileName);
            filePreview.appendChild(previewItem);
        }

        // Publish article
        document.getElementById('publishBtn').addEventListener('click', () => {
            if (validateForm()) {
                publishArticle();
            }
        });

        // Save draft
        document.getElementById('draftBtn').addEventListener('click', () => {
            saveDraft();
        });

        // Preview article
        document.getElementById('previewBtn').addEventListener('click', () => {
            previewArticle();
        });

        function validateForm() {
            const title = document.getElementById('articleTitle').value.trim();
            const content = document.getElementById('articleContent').value.trim();
            const category = document.getElementById('articleCategory').value;
            
            if (!title) {
                alert('Мақала атын жазыңыз!');
                return false;
            }
            
            if (!content) {
                alert('Мақала мазмунын жазыңыз!');
                return false;
            }
            
            if (!category) {
                alert('Категория таңлаңыз!');
                return false;
            }
            
            return true;
        }

        function publishArticle() {
            // Collect all language versions
            LANGUAGE_CONTENT[ADMIN.currentLanguage] = {
                title: document.getElementById('articleTitle').value,
                content: document.getElementById('articleContent').value
            };
            
            const article = {
                id: Date.now(),
                category: document.getElementById('articleCategory').value,
                languages: LANGUAGE_CONTENT,
                files: ADMIN.uploadedFiles.map(file => ({
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    url: URL.createObjectURL(file)
                })),
                publishDate: new Date().toISOString(),
                status: 'published'
            };
            
            // Save to local storage (in real app - send to server)
            const articles = JSON.parse(localStorage.getItem('kv_articles') || '[]');
            articles.unshift(article);
            localStorage.setItem('kv_articles', JSON.stringify(articles));
            
            // Show success message
            const successMsg = document.getElementById('successMessage');
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
            
            // Clear form
            clearForm();
            loadRecentArticles();
            
            console.log('Мақала жәрияланды:', article);
        }

        function saveDraft() {
            LANGUAGE_CONTENT[ADMIN.currentLanguage] = {
                title: document.getElementById('articleTitle').value,
                content: document.getElementById('articleContent').value
            };
            
            const draft = {
                id: Date.now(),
                category: document.getElementById('articleCategory').value,
                languages: LANGUAGE_CONTENT,
                files: ADMIN.uploadedFiles,
                saveDate: new Date().toISOString(),
                status: 'draft'
            };
            
            const drafts = JSON.parse(localStorage.getItem('kv_drafts') || '[]');
            drafts.unshift(draft);
            localStorage.setItem('kv_drafts', JSON.stringify(drafts));
            
            alert('Мақала сақталды! 💾');
        }

        function previewArticle() {
            const title = document.getElementById('articleTitle').value;
            const content = document.getElementById('articleContent').value;
            const category = document.getElementById('articleCategory').value;
            
            if (!title || !content) {
                alert('Алдымен мақала атын және мазмунын толтырыңыз!');
                return;
            }
            
            // Open preview in new window
            const previewWindow = window.open('', '_blank', 'width=800,height=600');
            previewWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Preview: ${title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; }
                        .preview-header { border-bottom: 2px solid #ddd; padding-bottom: 1rem; margin-bottom: 2rem; }
                        .preview-title { font-size: 2rem; color: #333; margin-bottom: 0.5rem; }
                        .preview-meta { color: #666; font-size: 0.9rem; }
                        .preview-content { line-height: 1.8; white-space: pre-wrap; }
                        .preview-files { margin-top: 2rem; }
                        .preview-files img, .preview-files video { max-width: 100%; border-radius: 10px; margin: 1rem 0; }
                    </style>
                </head>
                <body>
                    <div class="preview-header">
                        <h1 class="preview-title">${title}</h1>
                        <div class="preview-meta">Категория: ${category} | Язык: ${ADMIN.currentLanguage.toUpperCase()} | ${new Date().toLocaleDateString()}</div>
                    </div>
                    <div class="preview-content">${content.replace(/\n/g, '<br>')}</div>
                    <div class="preview-files">
                        ${ADMIN.uploadedFiles.map(file => {
                            if (file.type.startsWith('image/')) {
                                return `<img src="${URL.createObjectURL(file)}" alt="${file.name}">`;
                            } else if (file.type.startsWith('video/')) {
                                return `<video controls><source src="${URL.createObjectURL(file)}" type="${file.type}"></video>`;
                            } else if (file.type.startsWith('audio/')) {
                                return `<audio controls><source src="${URL.createObjectURL(file)}" type="${file.type}"></audio>`;
                            }
                            return '';
                        }).join('')}
                    </div>
                </body>
                </html>
            `);
        }

        function clearForm() {
            document.getElementById('articleTitle').value = '';
            document.getElementById('articleContent').value = '';
            document.getElementById('articleCategory').value = '';
            document.getElementById('mediaFiles').value = '';
            filePreview.innerHTML = '';
            ADMIN.uploadedFiles = [];
            
            // Clear all language content
            Object.keys(LANGUAGE_CONTENT).forEach(lang => {
                LANGUAGE_CONTENT[lang] = { title: '', content: '' };
            });
            
            // Reset to Russian tab
            document.querySelectorAll('.lang-tab').forEach(t => t.classList.remove('active'));
            document.querySelector('.lang-tab[data-lang="ru"]').classList.add('active');
            ADMIN.currentLanguage = 'ru';
            updatePlaceholders('ru');
        }

        function loadRecentArticles() {
            const articles = JSON.parse(localStorage.getItem('kv_articles') || '[]');
            const recentContainer = document.getElementById('recentArticles');
            
            if (articles.length === 0) {
                recentContainer.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.6);">Мақалалар жоқ</p>';
                return;
            }
            
            recentContainer.innerHTML = articles.slice(0, 10).map(article => `
                <div class="article-item">
                    <div class="article-info">
                        <h4>${article.languages.ru?.title || article.languages.kaa?.title || 'Без названия'}</h4>
                        <div class="article-meta">
                            ${article.category} • ${new Date(article.publishDate).toLocaleDateString()} • ${article.status}
                        </div>
                    </div>
                    <div class="article-actions">
                        <button class="edit-btn" onclick="editArticle('${article.id}')">✏️</button>
                        <button class="delete-btn" onclick="deleteArticle('${article.id}')">🗑️</button>
                    </div>
                </div>
            `).join('');
        }

        function editArticle(id) {
            const articles = JSON.parse(localStorage.getItem('kv_articles') || '[]');
            const article = articles.find(a => a.id == id);
            
            if (article) {
                // Load article data
                document.getElementById('articleCategory').value = article.category;
                LANGUAGE_CONTENT = article.languages;
                
                // Load current language content
                document.getElementById('articleTitle').value = article.languages[ADMIN.currentLanguage]?.title || '';
                document.getElementById('articleContent').value = article.languages[ADMIN.currentLanguage]?.content || '';
                
                // Load files (if available)
                ADMIN.uploadedFiles = article.files || [];
                
                // Scroll to form
                document.querySelector('.article-form').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function deleteArticle(id) {
            if (confirm('Мақаланы өшириўге  исенимлисиз бе?')) {
                const articles = JSON.parse(localStorage.getItem('kv_articles') || '[]');
                const filteredArticles = articles.filter(a => a.id != id);
                localStorage.setItem('kv_articles', JSON.stringify(filteredArticles));
                loadRecentArticles();
                alert('Мақала өширилди!');
            }
        }

        // Auto-save draft every 2 minutes
        setInterval(() => {
            if (ADMIN.isLoggedIn) {
                const title = document.getElementById('articleTitle').value.trim();
                const content = document.getElementById('articleContent').value.trim();
                
                if (title || content) {
                    saveDraft();
                    console.log('Автосақлаў орынланды');
                }
            }
        }, 120000); // 2 minutes

        // Initialize admin panel
        document.addEventListener('DOMContentLoaded', () => {
            updatePlaceholders('ru');
            
            // Check if already logged in (session)
            const session = localStorage.getItem('kv_admin_session');
            if (session && Date.now() < parseInt(session)) {
                ADMIN.isLoggedIn = true;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadRecentArticles();
                createAdminParticles();
            }
        });

        // Keep session alive
        function refreshSession() {
            if (ADMIN.isLoggedIn) {
                localStorage.setItem('kv_admin_session', (Date.now() + 1800000).toString()); // 30 min
            }
        }

        // Refresh session every 10 minutes
        setInterval(refreshSession, 600000);

        // Security: Clear sensitive data on page unload
        window.addEventListener('beforeunload', () => {
            if (!ADMIN.isLoggedIn) {
                localStorage.removeItem('kv_admin_session');
            }
        });

        console.log('🔐 KarakalpakVoice.org Admin Panel готов!');
        console.log('📱 Логин: karakalpak | Пароль: voice2025');
    </script>
</body>
</html>